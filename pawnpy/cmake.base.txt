cmake_minimum_required(VERSION 3.1)

set(CMAKE_CXX_STANDARD 14)

# check for optional include files
INCLUDE(${CMAKE_ROOT}/Modules/CheckIncludeFile.cmake)
CHECK_INCLUDE_FILE("unistd.h" HAVE_UNISTD_H)
IF(HAVE_UNISTD_H)
  ADD_DEFINITIONS(-DHAVE_UNISTD_H)
ENDIF(HAVE_UNISTD_H)
CHECK_INCLUDE_FILE("inttypes.h" HAVE_INTTYPES_H)
IF(HAVE_INTTYPES_H)
  ADD_DEFINITIONS(-DHAVE_INTTYPES_H)
ENDIF(HAVE_INTTYPES_H)
CHECK_INCLUDE_FILE("stdint.h" HAVE_STDINT_H)
IF(HAVE_STDINT_H)
  ADD_DEFINITIONS(-DHAVE_STDINT_H)
ENDIF(HAVE_STDINT_H)
CHECK_INCLUDE_FILE("alloca.h" HAVE_ALLOCA_H)
IF(HAVE_ALLOCA_H)
  ADD_DEFINITIONS(-DHAVE_ALLOCA_H)
ENDIF(HAVE_ALLOCA_H)

IF(UNIX)
  ADD_DEFINITIONS(-DENABLE_BINRELOC -D_GNU_SOURCE -DNO_ENTRYPOINT)
  INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/../linux)
  LINK_LIBRARIES(pthread m) #CMake adds the "lib" prefix, so "pthread" becomes "libpthread"
ENDIF(UNIX)
IF(WIN32)
  ADD_DEFINITIONS(-D_CRT_SECURE_NO_WARNINGS)
ENDIF(WIN32)
IF(APPLE)
  set(CMAKE_SHARED_LIBRARY_SUFFIX ".so")
  add_definitions(-DHAVE_SAFESTR)
ENDIF(APPLE)

set(PAWNCC ${PAWN}/compiler)
set(PAWNAMX ${PAWN}/amx)

set(PAWNCC_SRCS
  ${PAWNCC}/sc1.c
  ${PAWNCC}/sc2.c
  ${PAWNCC}/sc3.c
  ${PAWNCC}/sc4.c
  ${PAWNCC}/sc5.c
  ${PAWNCC}/sc6.c
  ${PAWNCC}/sc7.c
  ${PAWNCC}/scexpand.c
  ${PAWNCC}/sci18n.c
  ${PAWNCC}/sclist.c
  ${PAWNCC}/scmemfil.c
  ${PAWNCC}/scstate.c
  ${PAWNCC}/scvars.c
  ${PAWNCC}/lstring.c
  ${PAWNCC}/memfile.c
  ${PAWNAMX}/keeloq.c
  ${PAWN}/linux/binreloc.c
)

set(PAWNAMX_SRCS
  ${PAWNAMX}/amx.c
  ${PAWNAMX}/amxaux.c
)

if(WIN32)
  set(PAWNCC_SRCS ${PAWNCC_SRCS} pawncc.rc)
ENDIF(WIN32)
IF(UNIX)
  SET(PAWNCC_SRCS ${PAWNCC_SRCS} ${PAWN}/linux/binreloc.c)
ENDIF(UNIX)

add_definitions(-DNO_ENTRYPOINT)

include_directories(
  ${Boost_INCLUDE_DIRS}
  ${PYTHON_INCLUDE_DIRS}
  ${PAWN}/linux
)
